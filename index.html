<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GunkyZone</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=VT323&family=Share+Tech+Mono&family=IM+Fell+English:ital@0;1&display=swap" rel="stylesheet">
  <link rel="preload" href="/media.json" as="fetch" crossorigin>
  <link rel="preload" href="/thumbnails/TEAR1_thumb.jpg" as="image">
  <link rel="preload" href="/thumbnails/TEAR2_thumb.jpg" as="image">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg:        #020202;
      --bg2:       #050505;
      --bg3:       #0a0a0a;
      --border:    #1a1a1a;
      --dim:       #3a3a3a;
      --text:      #d4c0c0;
      --accent:    #9b0000;
      --accent2:   #cc0000;
      --glow:      rgba(155, 0, 0, 0.22);
      --font-mono: 'Share Tech Mono', monospace;
      --font-disp: 'VT323', monospace;
      --font-body: 'IM Fell English', serif;
    }

    html { scroll-behavior: smooth; scrollbar-gutter: stable; }
    body {
      background: var(--bg); color: var(--text);
      font-family: var(--font-mono); font-size: 15px;
      line-height: 1.7; min-height: 100vh; overflow-x: hidden;
      overflow-y: scroll;
    }
    body::before {
      content: ''; position: fixed; inset: 0;
      background: repeating-linear-gradient(to bottom, transparent 0px, transparent 2px, rgba(0,0,0,0.18) 2px, rgba(0,0,0,0.18) 4px);
      pointer-events: none; z-index: 1000;
    }
    body::after {
      content: ''; position: fixed; inset: 0;
      background: radial-gradient(ellipse at center, transparent 55%, rgba(0,0,0,0.8) 100%);
      pointer-events: none; z-index: 999;
      box-shadow: inset 0 0 200px 100px rgba(255, 255, 255, 0.02);
    }

    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; color: var(--accent2); }

    .site-wrapper {
      max-width: 860px; margin: 0 auto; padding: 0 20px;
      display: flex;
      flex-direction: column;
    }

    @keyframes crtBoot {
      0% { filter: brightness(1.05); opacity: 1; box-shadow: inset 0 0 100px 50px rgba(255, 255, 255, 0.08); }
      15% { box-shadow: inset 0 0 80px 40px rgba(255, 255, 255, 0.06); }
      25% { filter: brightness(1.03); opacity: 1; box-shadow: inset 0 0 40px 20px rgba(255, 255, 255, 0.04); }
      50% { filter: brightness(1.01); opacity: 0.98; clip-path: inset(40vh 0 40vh 0); box-shadow: none; }
      75% { opacity: 0.99; clip-path: inset(10vh 0 10vh 0); }
      100% { filter: brightness(1); opacity: 1; clip-path: inset(0 0 0 0); box-shadow: none; }
    }

    body { animation: crtBoot 1s cubic-bezier(0.34, 1.56, 0.64, 1); }

    header { border-bottom: 1px solid var(--border); padding: 48px 0 32px; }
    .header-tag { font-size: 11px; color: var(--dim); letter-spacing: 3px; text-transform: uppercase; margin-bottom: 12px; }
    .site-title {
      font-family: var(--font-disp); font-size: clamp(52px, 9vw, 90px);
      line-height: 1; color: var(--accent); text-shadow: 0 0 40px var(--glow); letter-spacing: 2px;
    }
    .site-title span { color: var(--accent2); }
    .cursor {
      display: inline-block; width: 2px; height: 0.85em;
      background: var(--accent); vertical-align: middle; margin-left: 4px;
      animation: blink 1.1s step-end infinite;
    }
    @keyframes blink { 50% { opacity: 0; } }
    @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

    .site-subtitle { font-family: var(--font-body); font-style: italic; color: var(--dim); font-size: 14px; margin-top: 10px; animation: slideIn 0.8s ease-out 0.3s both; }

    nav { display: flex; margin-top: 28px; border: 1px solid var(--border); width: fit-content; }
    nav a {
      display: block; padding: 7px 18px; color: var(--dim);
      font-size: 13px; letter-spacing: 1.5px; text-transform: uppercase;
      border-right: 1px solid var(--border); transition: all 0.15s;
    }
    nav a:last-child { border-right: none; }
    nav a:hover { background: var(--bg3); color: var(--accent); text-decoration: none; }
    nav a.active { background: var(--bg3); color: var(--accent); }

    main { padding: 40px 0 80px; }

    .welcome-box {
      border: 1px solid var(--border); padding: 24px 28px;
      background: linear-gradient(180deg, var(--bg2), #0b0b0b);
      margin-bottom: 36px; position: relative; border-radius: 6px;
      animation: fadeInUp 0.8s ease-out 0.5s both;
    }
    .welcome-box::before { content: '//'; position: absolute; top: -1px; left: 16px; background: var(--bg2); padding: 0 6px; font-size: 11px; color: var(--accent); }
    .welcome-box p { font-family: var(--font-body); font-size: 15px; color: var(--text); line-height: 1.9; }

    .section-label {
      font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: var(--dim);
      margin-bottom: 16px; display: flex; align-items: center; gap: 10px;
    }
    .section-label::after { content: ''; flex: 1; height: 1px; background: var(--border); }

    .featured-item {
      border: 2px solid var(--accent); padding: 20px;
      background: linear-gradient(135deg, rgba(155, 0, 0, 0.1), transparent);
      border-radius: 8px; margin-bottom: 20px; position: relative; overflow: hidden;
    }
    .featured-item h3 { color: var(--accent); font-family: var(--font-disp); font-size: 18px; margin-bottom: 8px; }

    .recent-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
      gap: 20px; margin-top: 16px; margin-bottom: 40px;
    }

    .recent-item {
      border: 1px solid var(--border); background: var(--bg2);
      border-radius: 6px; overflow: hidden; cursor: pointer;
      transition: all 0.3s; height: 160px; display: flex; padding: 12px; gap: 12px;
    }
    .recent-item:hover { border-color: var(--accent); box-shadow: 0 0 15px rgba(155, 0, 0, 0.2); }

    .recent-item-thumb {
      width: 100px; height: 100%; flex-shrink: 0;
      background: var(--bg3); border-radius: 4px;
      display: flex; align-items: center; justify-content: center; overflow: hidden;
    }
    .recent-item-thumb img { width: 100%; height: 100%; object-fit: cover; }
    
    .recent-item-info { flex: 1; display: flex; flex-direction: column; justify-content: center; }
    .recent-item-info h3 { font-size: 14px; color: var(--accent); text-transform: uppercase; }

    .chat-wrap { max-width: 680px; margin-top: 20px; border: 1px solid var(--border); }
    .chat-wrap iframe { width: 100%; height: 600px; border: none; background: #060606; }

    footer { border-top: 1px solid var(--border); padding: 24px 0; display: flex; justify-content: space-between; font-size: 11px; color: var(--dim); }
    .badge { border: 1px solid var(--border); padding: 3px 8px; font-size: 10px; text-transform: uppercase; margin-left: 8px; }

    #comic-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 10000; padding: 20px; }
  </style>
</head>
<body>

<div class="site-wrapper">
  <header>
    <div class="header-tag">est. 2025</div>
    <h1 class="site-title">GUNKY<span>ZONE</span><span class="cursor"></span></h1>
    <p class="site-subtitle"></p>
    <nav>
      <a href="index.html" class="active">home</a>
      <a href="comics.html">comics</a>
      <a href="drawings.html">drawings</a>
      <a href="chat-github.html">chat</a>
      <a href="about.html">about</a>
    </nav>
  </header>

  <main>
    <div class="welcome-box"><p></p></div>

    <div class="section-label">Featured</div>
    <div id="featured-section"></div>

    <div class="section-label">Recent Comics</div>
    <div id="recent-comics"></div>

    <div class="section-label">Recent Drawings</div>
    <div id="recent-drawings"></div>

    <div class="section-label">Live Chat</div>
    <div class="chat-wrap">
      <iframe src="chat-github.html?chat-only" title="GunkyZone chat"></iframe>
    </div>

    <div id="comic-modal">
      <button onclick="closeComicModal()" style="position: absolute; top: 20px; right: 20px; padding: 10px 20px; background: #9b0000; color: white; border: none; cursor: pointer; font-family: monospace;">CLOSE [X]</button>
      <iframe id="comic-iframe" style="width: 100%; height: calc(100% - 60px); border: none;" src=""></iframe>
    </div>
  </main>

  <footer>
    <span></span>
    <div class="footer-badges">
      <span class="badge">hosted on github</span>
      <span class="badge">firebase</span>
    </div>
  </footer>
</div>

<script>
  window.FIREBASE_CONFIG = {
    apiKey: "AIzaSyD1L4Mmgnbl0W7lk1rnaRu5wv61TSFhJqM",
    authDomain: "gunkychat.firebaseapp.com",
    databaseURL: "https://gunkychat-default-rtdb.firebaseio.com",
    projectId: "gunkychat",
    storageBucket: "gunkychat.firebasestorage.app",
    messagingSenderId: "423489767287",
    appId: "1:423489767287:web:ce847768781b0f589dc372"
  };

  function loadSiteContent() {
    var s1 = document.createElement('script');
    s1.src = 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js';
    s1.onload = function() {
      var s2 = document.createElement('script');
      s2.src = 'https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js';
      s2.onload = function() {
        firebase.initializeApp(window.FIREBASE_CONFIG);
        firebase.database().ref('/site_content').once('value', function(snap) {
          var data = snap.val() || {};
          if (data.subtitle) document.querySelector('.site-subtitle').textContent = data.subtitle;
          if (data.welcomeText) document.querySelector('.welcome-box p').textContent = data.welcomeText;
          if (data.footerText) document.querySelector('footer span').textContent = data.footerText;
        });
      };
      document.head.appendChild(s2);
    };
    document.head.appendChild(s1);
  }

  function loadRecentMedia() {
    fetch('media.json').then(function(res) { return res.json(); }).then(function(data) {
      var comics = data.comics || [];
      var drawings = data.drawings || [];
      comics.sort(function(a,b){ return b.uploadedAt - a.uploadedAt; });
      drawings.sort(function(a,b){ return b.uploadedAt - a.uploadedAt; });

      // Comics
      if (comics.length > 0) {
        var comicsHtml = '<div class="recent-grid">';
        for (var i = 0; i < Math.min(3, comics.length); i++) {
          comicsHtml += '<div class="recent-item" onclick="openComicViewer(\'' + comics[i].url.replace(/'/g, "\\'") + '\')">';
          comicsHtml += '<div class="recent-item-thumb">';
          if (comics[i].thumbnail) {
            comicsHtml += '<img src="' + comics[i].thumbnail + '" alt="thumb">';
          } else {
            comicsHtml += '<canvas id="comic-thumb-' + i + '"></canvas>';
          }
          comicsHtml += '</div><div class="recent-item-info"><h3>' + comics[i].title + '</h3></div></div>';
        }
        comicsHtml += '</div>';
        document.getElementById('recent-comics').innerHTML = comicsHtml;
        
        // Trigger PDF thumbs if no static thumbnail provided
        comics.slice(0,3).forEach(function(c, idx) {
          if(!c.thumbnail) renderPDFThumb(c.url, 'comic-thumb-' + idx);
        });
      }

      // Drawings
      if (drawings.length > 0) {
        var drawingsHtml = '<div class="recent-grid">';
        for (var j = 0; j < Math.min(3, drawings.length); j++) {
          drawingsHtml += '<div class="recent-item" onclick="location.href=\'drawings.html\'">';
          drawingsHtml += '<div class="recent-item-thumb"><img src="' + drawings[j].url + '" alt="drawing"></div>';
          drawingsHtml += '<div class="recent-item-info"><h3>' + drawings[j].title + '</h3></div></div>';
        }
        drawingsHtml += '</div>';
        document.getElementById('recent-drawings').innerHTML = drawingsHtml;
      }
    });
  }

  function renderPDFThumb(pdfUrl, canvasId) {
    if (!window.pdfjsLib) {
      var s = document.createElement('script');
      s.src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js';
      s.onload = function() { renderPDFThumb(pdfUrl, canvasId); };
      document.head.appendChild(s);
      return;
    }
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    pdfjsLib.getDocument(pdfUrl).promise.then(function(pdf) {
      pdf.getPage(1).then(function(page) {
        var canvas = document.getElementById(canvasId);
        if (!canvas) return;
        var viewport = page.getViewport({ scale: 0.2 });
        canvas.width = viewport.width; canvas.height = viewport.height;
        page.render({ canvasContext: canvas.getContext('2d'), viewport: viewport });
      });
    });
  }

  function openComicViewer(url) {
    document.getElementById('comic-iframe').src = 'pdf-viewer.html?url=' + encodeURIComponent(url);
    document.getElementById('comic-modal').style.display = 'block';
  }
  function closeComicModal() {
    document.getElementById('comic-modal').style.display = 'none';
    document.getElementById('comic-iframe').src = '';
  }

  document.addEventListener('DOMContentLoaded', function() {
    loadSiteContent();
    loadRecentMedia();
  });
</script>
</body>
</html>        // Show recent comics
        if (comics.length > 0) {
          var comicsHtml = '<div class="recent-grid">';
          for (var i = 0; i < Math.min(3, comics.length); i++) {
            comicsHtml += '<div class="recent-item" onclick="openComicViewer(\'' + comics[i].url.replace(/'/g, "\\'") + '\')">';
            if (comics[i].thumbnail) {
              comicsHtml += '<div class="recent-item-thumb"><img src="' + comics[i].thumbnail + '" alt="' + comics[i].title + '" loading="lazy" style="width: 100%; height: 100%; object-fit: cover;"></div>';
            } else {
              comicsHtml += '<div class="recent-item-thumb" style="background: var(--bg3); display: flex; align-items: center; justify-content: center;"><span style="font-size: 32px; color: var(--accent);">ðŸ“–</span></div>';
            }
            comicsHtml += '<div class="recent-item-info"><h3>' + comics[i].title + '</h3></div>';
            comicsHtml += '</div>';
          }
          comicsHtml += '</div>';
          var comicsEl = document.getElementById('recent-comics');
          if (comicsEl) {
            comicsEl.innerHTML = comicsHtml;
          }
        }  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadRecentMedia);
  } else {
    loadRecentMedia();
  }
</script>
